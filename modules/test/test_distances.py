import shapelets.compute as sc
from shapelets.compute.distances import DistanceType


def test_dist_euclidian():
    a = sc.array([[0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0]], dtype="float32")

    b = sc.array([
        [0, 0, 0, 0, 1, 1, 1, 1],
        [0, 0, 1, 1, 0, 0, 1, 1],
        [0, 1, 0, 1, 0, 1, 0, 1]
    ], dtype="float32")

    assert sc.distances.euclidian(a, b).same_as([
        [1.0000, 0.0000, 1.4142, 1.0000, 1.4142, 1.0000,  1.7321,  1.4142],
        [1.0000, 1.4142, 0.0000, 1.0000, 1.4142, 1.7321,  1.0000,  1.4142],
        [1.0000, 1.4142, 1.4142, 1.7321, 0.0000, 1.0000,  1.0000,  1.4142]
    ])

    assert sc.distances.pdist(b, DistanceType.Euclidian).same_as([
        [0.0000, 1.0000, 1.0000, 1.4142, 1.0000, 1.4142, 1.4142, 1.7321],
        [1.0000, 0.0000, 1.4142, 1.0000, 1.4142, 1.0000, 1.7321, 1.4142],
        [1.0000, 1.4142, 0.0000, 1.0000, 1.4142, 1.7321, 1.0000, 1.4142],
        [1.4142, 1.0000, 1.0000, 0.0000, 1.7321, 1.4142, 1.4142, 1.0000],
        [1.0000, 1.4142, 1.4142, 1.7321, 0.0000, 1.0000, 1.0000, 1.4142],
        [1.4142, 1.0000, 1.7321, 1.4142, 1.0000, 0.0000, 1.4142, 1.0000],
        [1.4142, 1.7321, 1.0000, 1.4142, 1.0000, 1.4142, 0.0000, 1.0000],
        [1.7321, 1.4142, 1.4142, 1.0000, 1.4142, 1.0000, 1.0000, 0.0000]
    ])


def test_dist_cityblock():
    a = sc.array([[0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0]], dtype="float32")

    b = sc.array([
        [0, 0, 0.0, 0, 1, 1, 1, 1],
        [0, 0, 1.3, 1, 0, 0, 1, 1],
        [0, 1, 0.0, 1, 0, 1, 0, 1]
    ], dtype="float32")

    assert sc.distances.cityblock(a, b).same_as([
        [1.0000, 0.0000, 2.3000, 1.0000, 2.0000, 1.0000, 3.0000, 2.0000],
        [1.0000, 2.0000, 0.3000, 1.0000, 2.0000, 3.0000, 1.0000, 2.0000],
        [1.0000, 2.0000, 2.3000, 3.0000, 0.0000, 1.0000, 1.0000, 2.0000],
    ])

    assert sc.distances.pdist(b, DistanceType.Manhattan).same_as([
        [0.0000, 1.0000, 1.3000, 2.0000, 1.0000, 2.0000, 2.0000, 3.0000],
        [1.0000, 0.0000, 2.3000, 1.0000, 2.0000, 1.0000, 3.0000, 2.0000],
        [1.3000, 2.3000, 0.0000, 1.3000, 2.3000, 3.3000, 1.3000, 2.3000],
        [2.0000, 1.0000, 1.3000, 0.0000, 3.0000, 2.0000, 2.0000, 1.0000],
        [1.0000, 2.0000, 2.3000, 3.0000, 0.0000, 1.0000, 1.0000, 2.0000],
        [2.0000, 1.0000, 3.3000, 2.0000, 1.0000, 0.0000, 2.0000, 1.0000],
        [2.0000, 3.0000, 1.3000, 2.0000, 1.0000, 2.0000, 0.0000, 1.0000],
        [3.0000, 2.0000, 2.3000, 1.0000, 2.0000, 1.0000, 1.0000, 0.0000]
    ])


def test_dist_hamming():
    a = sc.array([[0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0]], dtype="float32")

    b = sc.array([
        [0, 0, 0, 0, 1, 1, 1, 1],
        [0, 0, 1, 1, 0, 0, 1, 1],
        [0, 1, 0, 1, 0, 1, 0, 1]
    ], dtype="float32")

    assert sc.distances.hamming(a, b).same_as([
        [1, 0, 2, 1, 2, 1, 3, 2],
        [1, 2, 0, 1, 2, 3, 1, 2],
        [1, 2, 2, 3, 0, 1, 1, 2]
    ])
    assert sc.distances.pdist(b, DistanceType.Hamming).same_as([
        [0, 1, 1, 2, 1, 2, 2, 3],
        [1, 0, 2, 1, 2, 1, 3, 2],
        [1, 2, 0, 1, 2, 3, 1, 2],
        [2, 1, 1, 0, 3, 2, 2, 1],
        [1, 2, 2, 3, 0, 1, 1, 2],
        [2, 1, 3, 2, 1, 0, 2, 1],
        [2, 3, 1, 2, 1, 2, 0, 1],
        [3, 2, 2, 1, 2, 1, 1, 0],
    ])


def test_dist_minkowshi():
    a = sc.array([[0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0]], dtype="float32")

    b = sc.array([
        [0, 0, 0, 0, 1, 1, 1, 1],
        [0, 0, 1, 1, 0, 0, 1, 1],
        [0, 1, 0, 1, 0, 1, 0, 1]
    ], dtype="float32")

    assert sc.distances.minkowshi(a, b, 2.0).same_as(
        sc.distances.euclidian(a, b))
    assert sc.distances.minkowshi(a, b, 1.0).same_as(
        sc.distances.cityblock(a, b))
    assert sc.distances.minkowshi(a, b, 0.5).same_as([
        [1.0000, 0.0000, 4.0000, 1.0000, 4.0000, 1.0000, 9.0000, 4.0000],
        [1.0000, 4.0000, 0.0000, 1.0000, 4.0000, 9.0000, 1.0000, 4.0000],
        [1.0000, 4.0000, 4.0000, 9.0000, 0.0000, 1.0000, 1.0000, 4.0000]
    ])

    assert sc.distances.pdist(b, DistanceType.Minkowshi, p=0.5).same_as([
        [0.0000, 1.0000, 1.0000, 4.0000, 1.0000, 4.0000, 4.0000, 9.0000],
        [1.0000, 0.0000, 4.0000, 1.0000, 4.0000, 1.0000, 9.0000, 4.0000],
        [1.0000, 4.0000, 0.0000, 1.0000, 4.0000, 9.0000, 1.0000, 4.0000],
        [4.0000, 1.0000, 1.0000, 0.0000, 9.0000, 4.0000, 4.0000, 1.0000],
        [1.0000, 4.0000, 4.0000, 9.0000, 0.0000, 1.0000, 1.0000, 4.0000],
        [4.0000, 1.0000, 9.0000, 4.0000, 1.0000, 0.0000, 4.0000, 1.0000],
        [4.0000, 9.0000, 1.0000, 4.0000, 1.0000, 4.0000, 0.0000, 1.0000],
        [9.0000, 4.0000, 4.0000, 1.0000, 4.0000, 1.0000, 1.0000, 0.0000]
    ])


def test_dist_chebyshev():
    a = sc.array([[0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0]], dtype="float32")

    b = sc.array([
        [0, 0, 0, 0, 1, 1, 1, 1],
        [0, 0, 1, 1, 0, 0, 1, 1],
        [0, 1, 0, 1, 0, 1, 0, 1]
    ], dtype="float32")

    assert sc.distances.chebyshev(a, b).same_as([
        [1.0000, 0.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000],
        [1.0000, 1.0000, 0.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000],
        [1.0000, 1.0000, 1.0000, 1.0000, 0.0000, 1.0000, 1.0000, 1.0000]
    ])

    assert sc.distances.pdist(b, DistanceType.Chebyshev).same_as([
        [0.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000],
        [1.0000, 0.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000],
        [1.0000, 1.0000, 0.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000],
        [1.0000, 1.0000, 1.0000, 0.0000, 1.0000, 1.0000, 1.0000, 1.0000],
        [1.0000, 1.0000, 1.0000, 1.0000, 0.0000, 1.0000, 1.0000, 1.0000],
        [1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 0.0000, 1.0000, 1.0000],
        [1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 0.0000, 1.0000],
        [1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 1.0000, 0.0000]
    ])


def test_dist_sbd():
    a = sc.array([[0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0]], dtype="float32")

    b = sc.array([
        [0, 0, 0, 1, 1, 1, 1],
        [0, 1, 1, 0, 0, 1, 1],
        [1, 0, 1, 0, 1, 0, 1]
    ], dtype="float32")

    assert sc.distances.sbd(a, b).same_as([
        [0.0000, 0.0000, 0.2929, 0.0000, 0.2929, 0.2929, 0.4226],
        [0.0000, 0.0000, 0.2929, 0.0000, 0.2929, 0.2929, 0.4226],
        [0.0000, 0.0000, 0.2929, 0.0000, 0.2929, 0.2929, 0.4226]
    ])

    assert sc.distances.pdist(b, DistanceType.SBD).same_as([
        [0.0000, 0.0000, 0.2929, 0.0000, 0.2929, 0.2929, 0.4226],
        [0.0000, 0.0000, 0.2929, 0.0000, 0.2929, 0.2929, 0.4226],
        [0.2929, 0.2929, 0.0000, 0.2929, 0.5000, -0.0000, 0.1835],
        [0.0000, 0.0000, 0.2929, 0.0000, 0.2929, 0.2929, 0.4226],
        [0.2929, 0.2929, 0.5000, 0.2929, 0.0000, 0.5000, 0.1835],
        [0.2929, 0.2929, -0.0000, 0.2929, 0.5000, 0.0000, 0.1835],
        [0.4226, 0.4226, 0.1835, 0.4226, 0.1835, 0.1835, 0.0000]
    ])


def test_dist_dtw():
    sc.set_backend(sc.Backend.OpenCL)
    a = sc.array([[0, 0, 1],
                  [0, 1, 0],
                  [1, 0, 0]], dtype="float32")

    b = sc.array([
        [0, 0, 0, 0, 1, 1, 1, 1],
        [0, 0, 1, 1, 0, 0, 1, 1],
        [0, 1, 0, 1, 0, 1, 0, 1]
    ], dtype="float32")

    assert sc.distances.dtw(a, b).same_as([
        [1.0000, 0.0000, 1.0000, 0.0000, 2.0000, 1.0000, 3.0000, 2.0000],
        [1.0000, 1.0000, 0.0000, 1.0000, 1.0000, 2.0000, 1.0000, 2.0000],
        [1.0000, 2.0000, 1.0000, 3.0000, 0.0000, 1.0000, 0.0000, 2.0000]
    ])

    assert sc.distances.pdist(b, DistanceType.DTW).same_as([
        [0.0000, 1.0000, 1.0000, 2.0000, 1.0000, 2.0000, 2.0000, 3.0000],
        [1.0000, 0.0000, 1.0000, 0.0000, 2.0000, 1.0000, 3.0000, 2.0000],
        [1.0000, 1.0000, 0.0000, 1.0000, 1.0000, 2.0000, 1.0000, 2.0000],
        [2.0000, 0.0000, 1.0000, 0.0000, 3.0000, 1.0000, 2.0000, 1.0000],
        [1.0000, 2.0000, 1.0000, 3.0000, 0.0000, 1.0000, 0.0000, 2.0000],
        [2.0000, 1.0000, 2.0000, 1.0000, 1.0000, 0.0000, 1.0000, 1.0000],
        [2.0000, 3.0000, 1.0000, 2.0000, 0.0000, 1.0000, 0.0000, 1.0000],
        [3.0000, 2.0000, 2.0000, 1.0000, 2.0000, 1.0000, 1.0000, 0.0000]
    ])
